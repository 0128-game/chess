<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ChatGPTチェス対戦</title>
  <style>
    body { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#f0f0f0; font-family:Arial,sans-serif; }
    chess-board { width:400px; margin-bottom:15px; }
    #status { font-size:18px; font-weight:bold; }
  </style>

  <!-- 1. chess.js を先に読み込む -->
  <script src="https://cdn.jsdelivr.net/npm/chess.js@1.0.0/dist/chess.min.js"></script>

  <!-- 2. chessboard-element -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboard-element@1.2.0/dist/chessboard-1.2.0.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chessboard-element@1.2.0/dist/chessboard-1.2.0.min.js"></script>
</head>
<body>
  <h1>ChatGPTチェス対戦</h1>
  <chess-board id="board" draggable-pieces></chess-board>
  <div id="status">あなたが白です。先手を指してください。</div>

  <script>
    const game = new Chess(); // chess.jsのChessクラス
    const board = document.getElementById('board');
    const statusEl = document.getElementById('status');

    board.addEventListener('drop', (e)=>{
      const move = game.move({from:e.detail.source, to:e.detail.target, promotion:'q'});
      if(!move){ e.preventDefault(); return; }
      updateStatus();
      setTimeout(makeAIMove,250);
    });

    function makeAIMove(){
      if(game.game_over()) return;
      const moves = game.moves();
      const move = moves[Math.floor(Math.random()*moves.length)];
      game.move(move);
      board.setPosition(game.fen());
      updateStatus();
    }

    function updateStatus(){
      let status='';
      if(game.in_checkmate()) status='チェックメイト！'+(game.turn()==='w'?'黒の勝ち！':'白の勝ち！');
      else if(game.in_draw()) status='引き分けです。';
      else status=(game.turn()==='w'?'白（あなた）':'黒（AI）')+'の手番です';
      statusEl.textContent=status;
    }
  </script>
</body>
</html>
